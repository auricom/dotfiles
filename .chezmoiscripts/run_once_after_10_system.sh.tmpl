{{- if .desktop -}}
#!/usr/bin/env bash

# Desktop environment configuration script
# Configures GNOME settings and desktop preferences

set -euo pipefail

# Source utility functions
source "{{ .chezmoi.homeDir }}/.local/lib/chezmoi_utils.sh"

main() {
    log_section "Configuring desktop environment"

    deactivate_swap
    activate_brew_timers

    log_info "Desktop configuration completed"
}


deactivate_swap() {
    log_info "Checking system memory for swap configuration"

    # Check if swap is currently active
    if swapon --show | grep -q .; then
        log_info "Deactivating active swap"
        if sudo swapoff -a; then
            log_info "Successfully deactivated swap"
        else
            log_warn "Failed to deactivate swap"
            return
        fi
    else
        log_info "No active swap found"
    fi
}

activate_brew_timers() {
    log_info "Activating Homebrew systemd timers"

    for timer in brew-update.timer brew-upgrade.timer; do
        if systemctl list-unit-files "$timer" &>/dev/null 2>&1; then
            if systemctl is-active "$timer" &>/dev/null; then
                log_info "$timer is already active"
            else
                if sudo systemctl enable --now "$timer"; then
                    log_info "Activated $timer"
                else
                    log_warn "Failed to activate $timer"
                fi
            fi
        else
            log_info "$timer not found, skipping"
        fi
    done
}

# Run main function
main "$@"
{{- end -}}
