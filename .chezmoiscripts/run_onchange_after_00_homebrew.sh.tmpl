#!/usr/bin/env bash

# Package installation script
# This script installs packages via Homebrew
# Hash dependencies: {{ include "Brewfile.tmpl" | sha256sum }}

set -euo pipefail

# Source utility functions
source "{{ .chezmoi.workingTree }}/dot_local/lib/chezmoi_utils.sh"

main() {
    log_section "Installing Homebrew packages"

    if ! command_exists brew; then
        log_error "Homebrew is not installed"
        exit 1
    fi

    run_spin "Updating Homebrew..." brew update
    log_info "Homebrew updated"

    run_spin "Installing packages..." brew bundle --file="{{ .chezmoi.homeDir }}/Brewfile"
    log_info "Homebrew packages installation completed"
    log_info "To remove unlisted packages, run: brew bundle cleanup --file={{ .chezmoi.workingTree }}/Brewfile"
}

# Only run if conditions are met
if should_run; then
    main "$@"
else
    log_debug "Skipping package installation"
fi
